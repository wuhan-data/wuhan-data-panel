<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
    <mapper namespace="com.wuhan_data.app.mapper.IndiSearchMapper">
       
<!--          获得搜索的所有指标来源 -->
        <select id="searchSource" resultType="String">
            select source from   WUHAN_DATA."INDEX_LIST"  group by source   
        </select>
        
<!--         获得该用户的历史搜索 -->
 		  <select id="getHistorySearch" parameterType="_int" resultType="HistorySearch">
            select * from   WUHAN_DATA."HISTORY_SEARCH"  where uid= #{uid} order by id DESC limit 5  
        </select>
      
     
      <select id="searchIndi" resultType="IndexManage" parameterType="java.util.Map">
            select INDI_SEQ_ID as indi_code,INDI_NAME_CH as indi_name,INDICATOR_GRP20_ITEM_NAME as sjly_name2 from PLATFORM1."SRIT_DATA_INDICATOR_TJ" where INDI_NAME_CH like CONCAT('%',#{keyWord},'%')  and INDICATOR_GRP20_ITEM_NAME=#{source} group by  indi_seq_id,INDI_NAME_CH, INDICATOR_GRP20_ITEM_NAME
        </select> 
        
         <select id="searchIndiAll" resultType="IndexManage" parameterType="String">
            select INDI_SEQ_ID as indi_code,INDI_NAME_CH as indi_name,INDICATOR_GRP20_ITEM_NAME as sjly_name2 from PLATFORM1."SRIT_DATA_INDICATOR_TJ" where INDI_NAME_CH like CONCAT('%',#{keyWord},'%') and (INDICATOR_GRP20_ITEM_NAME='湖北指数' or INDICATOR_GRP20_ITEM_NAME='国家统计局' or INDICATOR_GRP20_ITEM_NAME='湖北省统计局') group by  indi_seq_id,INDI_NAME_CH, INDICATOR_GRP20_ITEM_NAME
        </select> 
        
<!--        获得前十四天的搜索趋势 -->
		 <select id="getTrendList" resultType="String" parameterType="String">
            select keyword from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} 
        </select> 
         <select id="getTrendList1" resultType="String" parameterType="String">
            select create_time from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} 
        </select> 
        
         <select id="getTrendSource" resultType="String" parameterType="java.util.Map">
            select source from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} and keyword=#{indi_name} group by source limit 1
        </select> 
        
         <insert id="addSearchHistory" parameterType="HistorySearch" >
            insert into WUHAN_DATA."HISTORY_SEARCH"(uid,keyword,create_time,source)values (#{uid},#{keyword},#{create_time},#{source})
        </insert>
        
    </mapper>
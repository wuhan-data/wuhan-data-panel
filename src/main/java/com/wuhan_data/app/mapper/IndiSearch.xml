<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
    <mapper namespace="com.wuhan_data.app.mapper.IndiSearchMapper">
       
<!--          获得搜索的所有指标来源 -->
        <select id="searchSource" resultType="String">
            select source from   WUHAN_DATA."INDEX_LIST"  group by source   
        </select>
        
<!--         获得该用户的历史搜索 -->
 		  <select id="getHistorySearch" parameterType="_int" resultType="HistorySearch">
            select * from   WUHAN_DATA."HISTORY_SEARCH"  where uid= #{uid} order by id DESC limit 5  
        </select>
      
     
      <select id="searchIndi" resultType="IndexManage" parameterType="java.util.Map">
            select indi_code,indi_name,sjly_name2 from MIDUSER."DT_EXP_ALL_SJLY" where indi_name like CONCAT('%',#{keyWord},'%') and group_count=0 and sjly_name2=#{source} and (time_point = '104' or time_point = '203') group by indi_code,indi_name,sjly_name2
        </select> 
        
         <select id="searchIndiG" resultType="IndexManage" parameterType="String">
            select indi_code,new_indi_name as indi_name,source,lj,is_show from WUHAN_DATA."APP_INDI_G" where new_indi_name like CONCAT('%',#{keyWord},'%') group by indi_code,new_indi_name,source,lj,is_show
        </select> 
        
        <select id="searchIndiH" resultType="IndexManage" parameterType="String">
            select indi_code,indi_new_name as indi_name,source,area_code,area_name,lj,is_show from MIDUSER."APP_INDI_H" where indi_new_name like CONCAT('%',#{keyWord},'%') and area_code='420000000000' group by indi_code,indi_new_name,source,area_code,area_name,lj,is_show
        </select> 
        
         <select id="getIsArea" resultType="int" parameterType="IndexManage">
            select count(*) from MIDUSER."APP_INDI_H" where indi_new_name = #{indi_name} and area_code &lt; '430000000000' and area_code &gt; '420000000000' and lj = #{lj}
        </select> 
        
<!--        获得前十四天的搜索趋势 -->
		 <select id="getTrendList" resultType="String" parameterType="String">
            select keyword from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} 
        </select> 
         <select id="getTrendList1" resultType="String" parameterType="String">
            select create_time from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} 
        </select> 
        
         <select id="getTrendSource" resultType="String" parameterType="java.util.Map">
            select source from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} and keyword=#{indi_name} group by source limit 1
        </select> 
        
        <select id="getTrendLj" resultType="String" parameterType="java.util.Map">
            select lj from WUHAN_DATA."HISTORY_SEARCH" where  create_time &lt; #{nowDate} and keyword=#{indi_name} and source=#{source} group by lj limit 1
        </select> 
        
         <insert id="addSearchHistory" parameterType="HistorySearch" >
            insert into WUHAN_DATA."HISTORY_SEARCH"(uid,keyword,create_time,source,lj)values (#{uid},#{keyword},#{create_time},#{source},#{lj})
        </insert>
        
    </mapper>
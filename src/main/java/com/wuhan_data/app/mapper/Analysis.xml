<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wuhan_data.app.mapper.AnalysisMapper">
	
	<select id="getAnalysisList"
  resultType="com.wuhan_data.pojo.AnalysisTheme">
  SELECT DISTINCT
  `type_id` as listId,
  `type_name` as listName
  FROM
  WUHANDATA."ANALYSIS_THEME"
  WHERE
  `is_show` = 0 OR
  `is_show` = 9
  ORDER BY
  `type_weight` DESC
 </select>

	<select id="getAnalysisTypeList"
		resultType="com.wuhan_data.pojo.AnalysisType">
		SELECT
		type_id as typeId,
		type_name as typeName,
		type_weight as typeWeight,
		background,
		icon_url as iconUrl,
		is_show as isShow
		FROM WUHAN_DATA."ANALYSIS_TYPE"
		WHERE
		is_show = 0 OR is_show = 9
		ORDER BY type_weight ASC
	</select>
	
	<select id="getAnalysisLabelList"
		resultType="com.wuhan_data.pojo.AnalysisLabel" parameterType="int">
		SELECT
		label_id as labelId,
		type_id as typeId,
		label_name as labelName,
		label_weight as labelWeight,
		is_show as isShow
		FROM WUHAN_DATA."ANALYSIS_LABEL"
		WHERE
		type_id = #{type_id} AND
		(is_show = 0 OR is_show = 9)
		ORDER BY label_weight ASC
	</select>

	<select id="getAnalysisThemeList"
		resultType="com.wuhan_data.pojo.AnalysisTheme" parameterType="int">
		SELECT
		theme_id as themeId,
		label_id as labelId,
		theme_name as themeName,
		theme_weight as themeWeight,
		is_show as isShow
		FROM WUHAN_DATA."ANALYSIS_THEME"
		WHERE
		label_id = #{label_id} AND
		(is_show = 0 OR is_show = 9)
		ORDER BY theme_weight ASC
	</select>
	
	<select id="searchAnalysis"
		resultType="com.wuhan_data.pojo.AnalysisSearch" parameterType="String">
		SELECT
		theme_id as themeId,
		theme_name as themeName,
		theme_weight as themeWeight,
		label_id as labelId,
		label_name as labelName,
		type_id as typeId,
		type_name as typeName,
		is_show as isShow
		FROM WUHAN_DATA."ANALYSIS_SEARCH"
		WHERE
		theme_name like CONCAT('%',#{keyword},'%') AND
		(is_show = 0 OR is_show = 9)
		ORDER BY theme_weight ASC
	</select>

	<select id="getThemeBaseInfo"
		resultType="com.wuhan_data.pojo.AnalysisTheme" parameterType="int">
		SELECT
		theme_id as themeId,
		theme_name as themeName,
		is_show as isShow
		FROM WUHAN_DATA."ANALYSIS_THEME"
		WHERE
		theme_id = #{theme_id}
	</select>

	<!-- TODO 查询指定INDI_NAME的最新指标描述数据 -->

	<select id="getAnalysisPlate"
		resultType="com.wuhan_data.pojo.AnalysisPlate" parameterType="int">
		SELECT
		plate_id as plateId,
		a.theme_id as themeId,
		b.theme_name as themeName,
		plate_name as plateName,
		show_type as showType,
		show_term as showTerm,
		a.is_show as isShow
		FROM WUHAN_DATA."ANALYSIS_PLATE" a
		INNER JOIN WUHAN_DATA."ANALYSIS_THEME" b
		ON a.theme_id=b.theme_id
		WHERE
		a.theme_id = #{themeId} AND
		a.is_show = 0
		ORDER BY plate_id ASC
	</select>

	<!-- 获取指定板块下的指标信息 -->
	<select id="getIndiByPid"
		resultType="com.wuhan_data.pojo.AnalysisIndi" parameterType="int">
		SELECT
		indi_id as indiId,
		plate_id as plateId,
		search_indi_id as indiCode,
		indi_new_name as indiName,
		show_type as showType,
		show_color as
		showColor,
		indi_weight as indiWeight,
		is_show as
		isShow
		FROM WUHAN_DATA."ANALYSIS_INDI"
		WHERE
		plate_id = #{plateId} AND
		is_show = 0
		ORDER BY indi_weight DESC
	</select>

	<!-- 获取指标的所有可取频度(物化视图) -->
	<select id="getFreqnameByIndicode" resultType="String"
		parameterType="String">
		SELECT DISTINCT
		FREQ_NAME as freqName
		FROM "MIDUSER"."APP_ANALYSIS_INDI_TIME"
		WHERE
		INDI_CODE = #{indiCode}
	</select>

	<select id="getTimeByFreq"
		resultType="com.wuhan_data.pojo.AnalysisIndiTime"
		parameterType="java.util.Map">
		SELECT DISTINCT
		INDI_CODE as indiCode,
		FREQ_NAME as
		freqName,
		START_TIME as startTime,
		END_TIME as endTime
		FROM "MIDUSER"."APP_ANALYSIS_INDI_TIME"
		WHERE
		INDI_CODE = #{indiCode} AND
		FREQ_NAME = #{freqName}
	</select>

	<!-- 获取指标指定频度的时间跨度 -->
	<select id="getTimeByFreqname" resultType="String"
		parameterType="java.util.Map">
		<!-- select "INDI_CODE","FREQ_NAME","INDI_TIME","TIME_POINT","INDI_VALUE","UNIT_NAME" 
			from "MIDUSER"."APP_ANALYSIS_INDI_VALUE"; -->
		SELECT
		INDI_TIME as time
		FROM "MIDUSER"."APP_ANALYSIS_INDI_VALUE"
		WHERE
		INDI_CODE = #{indiCode} AND
		FREQ_NAME = #{freqName}
		ORDER BY INDI_TIME DESC
	</select>


	<select id="getIndiValue"
		resultType="com.wuhan_data.pojo.AnalysisIndiValue"
		parameterType="java.util.Map">
		SELECT
		INDI_CODE as indiCode,
		FREQ_NAME as freqName,
		INDI_TIME as time,
		TIME_POINT as timePoint,
		INDI_VALUE as indiValue,
		UNIT_NAME as unitName
		FROM "MIDUSER"."APP_ANALYSIS_INDI_VALUE"
		WHERE
		INDI_CODE = #{indiCode} AND
		FREQ_NAME = #{freqName} AND
		INDI_TIME &gt;=
		#{startTime} AND
		INDI_TIME &lt;= #{endTime}
		ORDER BY INDI_TIME DESC
	</select>



</mapper>
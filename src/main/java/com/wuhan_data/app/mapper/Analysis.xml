<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wuhan_data.app.mapper.AnalysisMapper">

	<select id="getAnalysisList"
		resultType="com.wuhan_data.pojo.AnalysisTheme">
		SELECT DISTINCT
		`type_id` as listId,
		`type_name` as listName
		FROM
		`analysis_theme`
		WHERE
		`is_show` = 0 OR
		`is_show` = 9
		ORDER BY
		`type_weight` DESC
	</select>

	<select id="getAnalysisSubList"
		resultType="com.wuhan_data.pojo.AnalysisTheme" parameterType="int">
		SELECT
		`theme_id` as themeId,
		`theme_name` as themeName,
		`is_show` as isShow
		FROM
		`analysis_theme`
		WHERE
		`type_id` = #{type_id} AND
		(`is_show` = 0 OR
		`is_show` = 9)
	</select>

	<!-- 查询指定INDI_NAME的最新指标描述数据 -->
	<select id="getAnalysisDesc1" resultType="map"
		parameterType="string">
		SELECT
		`TIME_POINT` as descName,
		`INDI_VALUE` as descValue,
		`UNITNAME` as descUnit
		FROM
		`indi_all`
		WHERE
		`INDI_NAME` = #{indexName} AND
		`TIME_POINT` = 104
		ORDER BY `DATE_CODE` DESC
		LIMIT 1
	</select>
	
	<select id="getAnalysisDesc2" resultType="map"
		parameterType="string">
		SELECT
		`TIME_POINT` as descName,
		`INDI_VALUE` as descValue,
		`UNITNAME` as descUnit
		FROM
		`indi_all`
		WHERE
		`INDI_NAME` = #{indexName} AND
		`TIME_POINT` = 203
		ORDER BY `DATE_CODE` DESC
		LIMIT 1
	</select>
	
	<select id="getAnalysisDesc3" resultType="map"
		parameterType="string">
		SELECT
		`TIME_POINT` as descName,
		`INDI_VALUE` as descValue,
		`UNITNAME` as descUnit
		FROM
		`indi_all`
		WHERE
		`INDI_NAME` = #{indexName} AND
		`TIME_POINT` = 207
		ORDER BY `DATE_CODE` DESC
		LIMIT 1
	</select>
	
	<select id="getAnalysisPlate" resultType="com.wuhan_data.pojo.AnalysisPlate"
		parameterType="int">
		SELECT
		`plate_id` as plateId,
		a.`theme_id` as themeId,
		b.`theme_name` as themeName,
		`plate_name` as plateName,
		`show_type` as showType,
		`show_term` as showTerm,
		a.`is_show` as isShow
		FROM
		`analysis_plate` a
		INNER JOIN `analysis_theme` b
		ON a.theme_id=b.theme_id
		WHERE
		a.`theme_id` = #{theme_id} AND
		(a.`is_show` = 0 OR
		a.`is_show` = 9)
	</select>

</mapper>
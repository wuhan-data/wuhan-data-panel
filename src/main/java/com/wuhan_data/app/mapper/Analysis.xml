<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wuhan_data.app.mapper.AnalysisMapper">

	<select id="getAnalysisList"
		resultType="com.wuhan_data.pojo.AnalysisTheme">
		SELECT DISTINCT
		`type_id` as listId,
		`type_name` as listName
		FROM
		`analysis_theme`
		WHERE
		`is_show` = 0 OR
		`is_show` = 9
		ORDER BY
		`type_weight` DESC
	</select>

	<select id="getAnalysisSubList"
		resultType="com.wuhan_data.pojo.AnalysisTheme" parameterType="int">
		SELECT
		`theme_id` as themeId,
		`theme_name` as themeName,
		`type_name` as listName,
		`is_show` as isShow
		FROM
		`analysis_theme`
		WHERE
		`type_id` = #{type_id} AND
		(`is_show` = 0 OR
		`is_show` = 9)
	</select>

	<!-- 查询指定INDI_NAME的最新指标描述数据 -->
	<select id="getAnalysisDesc1" resultType="map"
		parameterType="string">
		SELECT
		`TIME_POINT` as descName,
		`INDI_VALUE` as descValue,
		`UNITNAME` as descUnit
		FROM
		`indi_all`
		WHERE
		`INDI_NAME` = #{indexName} AND
		`TIME_POINT` = 104
		ORDER BY `DATE_CODE` DESC
		LIMIT 1
	</select>
	
	<select id="getAnalysisDesc2" resultType="map"
		parameterType="string">
		SELECT
		`TIME_POINT` as descName,
		`INDI_VALUE` as descValue,
		`UNITNAME` as descUnit
		FROM
		`indi_all`
		WHERE
		`INDI_NAME` = #{indexName} AND
		`TIME_POINT` = 203
		ORDER BY `DATE_CODE` DESC
		LIMIT 1
	</select>
	
	<select id="getAnalysisDesc3" resultType="map"
		parameterType="string">
		SELECT
		`TIME_POINT` as descName,
		`INDI_VALUE` as descValue,
		`UNITNAME` as descUnit
		FROM
		`indi_all`
		WHERE
		`INDI_NAME` = #{indexName} AND
		`TIME_POINT` = 207
		ORDER BY `DATE_CODE` DESC
		LIMIT 1
	</select>
	
	<select id="getAnalysisPlate" resultType="com.wuhan_data.pojo.AnalysisPlate"
		parameterType="int">
		SELECT
		`plate_id` as plateId,
		a.`theme_id` as themeId,
		b.`theme_name` as themeName,
		`plate_name` as plateName,
		`show_type` as showType,
		`show_term` as showTerm,
		a.`is_show` as isShow
		FROM
		`analysis_plate` a
		INNER JOIN `analysis_theme` b
		ON a.theme_id=b.theme_id
		WHERE
		a.`theme_id` = #{themeId} AND
		a.`is_show` = 0
	</select>

	<!-- 获取指定板块下的指标信息 -->
	<select id="getIndiByPid" resultType="com.wuhan_data.pojo.AnalysisIndi"
	 parameterType="int">
		SELECT
		`indi_id` as indiId,
		`plate_id` as plateId,
		`search_indi_id` as indiCode,
		`indi_new_name` as indiName,
		`show_type` as showType,
		`show_color` as showColor,
		`indi_weight` as indiWeight,
		`is_show` as isShow
		FROM
		`analysis_indi`
		WHERE
		`plate_id` = #{plateId} AND
		`is_show` = 0
    </select>
    
    <!-- 获取指标的所有可取频度 -->
	<select id="getFreqnameByIndiid" resultType="String"
		parameterType="String">
		SELECT DISTINCT
		`INDICATOR_GRP21_ITEM_NAME` as freqName
		FROM
		`srit_data_indicator_tj`
		WHERE
		INDI_CODE = #{indiCode}
	</select>
	
	<!-- 获取指标指定频度的时间跨度 -->
	<select id="getTimeByFreq" resultType="String"
		parameterType="java.util.Map">
		SELECT
		`DATA_TIME_NAME` as time
		FROM
		`srit_data_indicator_tj`
		WHERE
		indiId = #{indiCode} AND
		INDICATOR_GRP21_ITEM_NAME = #{freqName} AND
		ORDER BY
		DATA_TIME_NAME DESC
		LIMIT 0, #{showTerm}
	</select>


</mapper>